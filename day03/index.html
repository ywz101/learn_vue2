<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta
    http-equiv="X-UA-Compatible"
    content="IE=edge"
  >
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0"
  >
  <title>è´­ç‰©è½¦æ¡ˆä¾‹</title>
  <link rel="stylesheet" href="./css/01-è´­ç‰©è½¦æ¡ˆä¾‹çš„ç»“æ„å’Œæ ·å¼.css">
</head>

<body>
  <!-- 1.å®šä¹‰å®¹å™¨ -->
  <div id="app">
    <div class="container">
      <div class="top">ğŸ  / è´­ç‰©è½¦</div>
      <div
        class="table"
        v-if="fruitList.length !== 0"
      >
        <div class="thead">
          <div class="tr">
            <div class="th">é€‰ä¸­</div>
            <div class="th">å›¾ç‰‡</div>
            <div class="th">å•ä»·</div>
            <div class="th">ä¸ªæ•°</div>
            <div class="th">å°è®¡</div>
            <div class="th">æ“ä½œ</div>
          </div>
        </div>
        <div class="tbody">
          <div
            class="tr"
            v-for="(item, index) in fruitList"
            :key="item.id"
            :class="{ active: item.isChecked }"
          >
            <div class="td">
              <input
                type="checkbox"
                v-model="item.isChecked"
              >
            </div>
            <div class="td">
              <img
                :src="item.icon"
                alt=""
              >
            </div>
            <div class="td">
              <span>{{ item.price }}</span>
            </div>
            <div class="td">
              <button
                @click="item.num--"
                :disabled="item.num <= 1"
              >-</button>
              <span>{{ item.num }}</span>
              <button @click="item.num++">+</button>
            </div>
            <div class="td">
              <span>{{ item.price * item.num }}</span>
            </div>
            <div class="td">
              <button @click="del(index)">åˆ é™¤</button>
            </div>
          </div>
        </div>
        <div class="tfoot">
          <div class="tr">
            <div class="td">
              <label>
                <input
                  type="checkbox"
                  v-model="checkedAll"
                >
                <span>å…¨é€‰</span>
              </label>
            </div>
            <div class="td">
              <span>æ€»ä»·: ï¿¥</span>
              <span>{{ totalPrice }}</span>
            </div>
            <div class="td">
              <button>ç»“ç®—ï¼ˆ{{ totalCount }}ï¼‰</button>
            </div>
          </div>
        </div>
      </div>
      <!-- æ²¡æœ‰å•†å“çš„æ—¶å€™æ˜¾ç¤º -->
      <div
        class="empty"
        v-else
      >ğŸ›’ç©ºç©ºå¦‚ä¹Ÿ</div>
    </div>
  </div>

  <!-- 2.å¼•å…¥vue.js -->
  <script src="./js/vue.js"></script>

  <!-- 3.å®ä¾‹åŒ–vue -->
  <script>
    new Vue({
      el: '#app',
      data: {
        fruitList: [
          {
            id: 1,
            icon: 'images/ç«é¾™æœ.png',
            isChecked: true,
            num: 2,
            price: 6,
          },
          {
            id: 2,
            icon: '/images/è”æ.png',
            isChecked: false,
            num: 7,
            price: 20,
          },
          {
            id: 3,
            icon: '/images/æ¦´è².png',
            isChecked: false,
            num: 3,
            price: 40,
          },
          {
            id: 4,
            icon: '/images/é¸­æ¢¨.png',
            isChecked: true,
            num: 10,
            price: 3,
          },
          {
            id: 5,
            icon: '/images/æ¨±æ¡ƒ.png',
            isChecked: false,
            num: 20,
            price: 34,
          },
        ]
      },
      methods: {
        del(index) {
          this.fruitList.splice(index, 1)
        }
      },
      computed: {
        totalPrice() {
          return this.fruitList.reduce((init, item) => {
            if (item.isChecked) {
              return init + item.price * item.num
            } else {
              return init
            }
          }, 0)
        },
        totalCount() {
          return this.fruitList.reduce((init, item) => {
            if (item.isChecked) {
              return init + item.num
            } else {
              return init
            }
          }, 0)
        },
        // å®Œæ•´å†™æ³•
        checkedAll: {
          get() {
            return this.fruitList.every(item => item.isChecked)
          },
          // item.isCheckedè¡¨ç¤ºæ¯ä¸€ä¸ªå•ç‹¬å•†å“çš„é€‰ä¸­çŠ¶æ€
          // valè¡¨ç¤ºå…¨é€‰æŒ‰é’®çš„çŠ¶æ€, é€‰ä¸­æ˜¯true, æ²¡æœ‰é€‰ä¸­æ˜¯false
          set(val) {
            return this.fruitList.forEach(item => item.isChecked = val)
          }
        }
      },
      watch: {
        // å®Œæ•´å†™æ³•
        fruitList: {
          handler(val) {
            // val: ä¾¦å¬åçš„ç»“æœ(ä¾èµ–é¡¹å‘ç”Ÿæ”¹å˜åçš„å€¼)
            // éœ€è¦å°†æœ€æ–°çš„ä¾¦å¬åˆ°çš„ç»“æœå­˜å‚¨åˆ°æœ¬åœ°å­˜å‚¨é‡Œé¢, æ¥å®ç°æ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨
            localStorage.setItem('list', JSON.stringify(val))
          },
          deep: true, // å¼€å¯æ·±åº¦ä¾¦å¬
        }
      },
      created() {
        // è¯»å–æœ¬åœ°çš„æ•°æ®, è¯»å–åˆ°çš„æ•°æ®é‡æ–°èµ‹å€¼ç»™å“åº”å¼æ•°æ®fruitList(æ•°æ®é©±åŠ¨è§†å›¾)
        this.fruitList = JSON.parse(localStorage.getItem('list')) || this.fruitList
      }
    })
  </script>
</body>

</html>